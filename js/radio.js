var playerStatusChanged; // used by Uppod player (SWF) in uppod/uppod_api.js
(function () {

    // Settings

    var options = {
        "player": {
            "playerUrl": "uppod/uppod.swf",
            "width": 280,
            "height": 37,
            "version": "9.0.115.0"
        }
    };

    var channels = [{
        "id": "za-oblakami-relax",
        "comment": "За облаками Relax",
        "style": "uppod/audio154-647.txt",
        "html5Style": "#07b02206306e07407206c06206702203a03002c02207306906402203a02203103503402d03603403702202c02206306e07407206c06d06107206706906e06c06506607402203a03302c02206306e07407206c07306907a06502203a03102e03202c02206d02203a02206107506406906f02202c02207206106406906f02203a03102c02207006106406406906e06702203a03202c02206206f06407906306f06c06f07202203a02206606606606606606602202c02206306e07407206c06d06107206706906e07206906706807402203a03302c02206802203a03303702c02206206706306f06c06f07202203a02203703906506403702202c02206f02203a03103102c02207306307206506506e06306f06c06f07202203a02203703906506403702202c02206306e07407206c06106c07006806102203a03002e03802c02207702203a03203803002c02206306f06e07407206f06c07302203a02207006c06107902c07307406f07002c07406906d06505f07006c06107902c07307006106306502c07606f06c07506d06502c07606f06c06206107206c06906e06502c07407206106606606906302202c02206c06106e06702203a02206506e02202c02206306e07407206c06f07507406806506906706807402203a03203502c02207306806f07706e06106d06502203a03007d",
        "streamUrl": "http://195.88.63.114:8000/relax",
        "bgcolor": "079ed7",
        "blockStyle": "dark",
        "siteUrl": "http://www.zaoblakami.ru"
    },{
        "id": "lite-sound-session",
        "comment": "Light sound session",
        "style": "uppod/audio154-808.txt",
        "html5Style": "#07b02206306e07407206c06206702203a03002c02207006106406406906e06702203a03202c02206206f06407906306f06c06f07202203a02206606606606606606602202c02206306e07407206c06d06107206706906e06c06506607402203a03302c02206306e07407206c07306907a06502203a03102e03202c02206d02203a02206107506406906f02202c02207206106406906f02203a03102c02207702203a03203803002c02206306e07407206c06d06107206706906e07206906706807402203a03302c02206802203a03303702c02207306806f07706e06106d06502203a03002c02206206706306f06c06f07202203a02203303803803603003002202c02206f02203a03103102c02207306307206506506e06306f06c06f07202203a02203303803803603003002202c02207306906402203a02203103503402d03803003802202c02206306f06e07407206f06c07302203a02207006c06107902c07307406f07002c07406906d06505f07006c06107902c07307006106306502c07606f06c07506d06502c07606f06c06206107206c06906e06502c07407206106606606906302202c02206c06106e06702203a02206506e02202c02206306e07407206c06f07507406806506906706807402203a03203502c02206306e07407206c06106c07006806102203a03002e03807d",
        "streamUrl": "http://www.litesoundsession.com:8000/lite",
        "bgcolor": "388600",
        "blockStyle": "dark",
        "siteUrl": "http://www.litesoundsession.com"
    },{
        "id": "relax-fm",
        "comment": "Relax FM",
        "style": "uppod/audio154-814.txt",
        "html5Style": "#07b02206306e07407206c06206702203a03002c02206306e07407206c06f07507406806506906706807402203a03203502c02206306e07407206c06d06107206706906e06c06506607402203a03302c02206306e07407206c06106c07006806102203a03002e03802c02206306e07407206c07306907a06502203a03102e03202c02206d02203a02206107506406906f02202c02207206106406906f02203a03102c02207702203a03203803002c02207306806f07706e06106d06502203a03002c02206306e07407206c06d06107206706906e07206906706807402203a03302c02206802203a03303702c02206206706306f06c06f07202203a02206606606406303806202202c02206f02203a03103102c02207006106406406906e06702203a03202c02207306906402203a02203103503402d03803103402202c02206306f06e07407206f06c07302203a02207006c06107902c07307406f07002c07406906d06505f07006c06107902c07307006106306502c07606f06c07506d06502c07606f06c06206107206c06906e06502c07407206106606606906302202c02206c06106e06702203a02206506e02202c02206306e07407206c06306f06c06f07202203a02206203506306202202c02206206f06407906306f06c06f07202203a02206203506306202202c02207306307206506506e06306f06c06f07202203a02206606606406303806202207d",
        "streamUrl": "http://eu4.101.ru:8000/v13_1",
        "bgcolor": "ffdc8b",
        "blockStyle": "light",
        "siteUrl": "http://www.relax-fm.ru"
    },{
        "id": "sanfm-relax",
        "style": "uppod/audio154-815.txt",
        "html5Style": "#07b02206306e07407206c06106c07006806102203a03002e03802c02206206f06407906306f06c06f07202203a02203703006103703106602202c02206306e07407206c06306f06c06f07202203a02203703006103703106602202c02206306e07407206c06f07507406806506906706807402203a03203502c02206306f06e07407206f06c07302203a02207006c06107902c07307406f07002c07406906d06505f07006c06107902c07307006106306502c07606f06c07506d06502c07606f06c06206107206c06906e06502c07407206106606606906302202c02206d02203a02206107506406906f02202c02207306906402203a02203103503402d03803103502202c02207306806f07706e06106d06502203a03002c02206306e07407206c06d06107206706906e06c06506607402203a03302c02206802203a03303702c02206306e07407206c06206702203a03002c02206f02203a03103102c02207206106406906f02203a03102c02207306307206506506e06306f06c06f07202203a02206206606503203503302202c02206206706306f06c06f07202203a02206206606503203503302202c02207006106406406906e06702203a03202c02206306e07407206c06d06107206706906e07206906706807402203a03302c02206306e07407206c07306907a06502203a03102e03202c02207702203a03203803002c02206c06106e06702203a02206506e02207d",
        "comment": "SanFM Relax",
        "streamUrl": "http://sanfm.ru:8000/relax",
        "bgcolor": "bfe253",
        "blockStyle": "light",
        "siteUrl": "http://sanfm.ru/relax/"
    },{
        "id": "radio-tunes-relaxation",
        "comment": "RadioTunes Relaxation",
        "style": "uppod/audio154-811.txt",
        "html5Style": "#07b02206306e07407206c06206702203a03002c02207306906402203a02203103503402d03803103102202c02206306e07407206c06d06107206706906e06c06506607402203a03302c02207006106406406906e06702203a03202c02206306e07407206c07306907a06502203a03102e03202c02206d02203a02206107506406906f02202c02207206106406906f02203a03102c02207702203a03203803002c02207306806f07706e06106d06502203a03002c02206306e07407206c06d06107206706906e07206906706807402203a03302c02206802203a03303702c02206206706306f06c06f07202203a02203506306106102202c02206f02203a03103102c02207306307206506506e06306f06c06f07202203a02203506306106102202c02206306e07407206c06106c07006806102203a03002e03802c02206306e07407206c06f07507406806506906706807402203a03203502c02206306f06e07407206f06c07302203a02207006c06107902c07307406f07002c07406906d06505f07006c06107902c07307006106306502c07606f06c07506d06502c07606f06c06206107206c06906e06502c07407206106606606906302202c02206c06106e06702203a02206506e02202c02206206f06407906306f06c06f07202203a02206606606606606606602207d",
        "streamUrl": "http://pub5.radiotunes.com/radiotunes_relaxation_aacplus?type=.flv",
        "bgcolor": "005caa",
        "blockStyle": "dark",
        "siteUrl": "http://www.radiotunes.com/relaxation"
    },{
        "id": "relax-ua",
        "comment": "Relax (UA)",
        "style": "uppod/audio154-816.txt",
        "html5Style": "#07b02206306e07407206c06206702203a03002c02206206f06407906306f06c06f07202203a02206203206403002202c02206306e07407206c06d06107206706906e06c06506607402203a03302c02206306e07407206c07306907a06502203a03102e03202c02206d02203a02206107506406906f02202c02207306806f07706e06106d06502203a03002c02206306e07407206c06f07507406806506906706807402203a03203502c02207306906402203a02203103503402d03803103602202c02206306e07407206c06d06107206706906e07206906706807402203a03302c02206802203a03303702c02206206706306f06c06f07202203a02206606606606606606602202c02206f02203a03103102c02207306307206506506e06306f06c06f07202203a02206606606606606606602202c02206306e07407206c06106c07006806102203a03002e03802c02207702203a03203803002c02206306f06e07407206f06c07302203a02207006c06107902c07307406f07002c07406906d06505f07006c06107902c07307006106306502c07606f06c07506d06502c07606f06c06206107206c06906e06502c07407206106606606906302202c02206c06106e06702203a02206506e02202c02206306e07407206c06306f06c06f07202203a02206203206403002202c02207006106406406906e06702203a03202c02207206106406906f02203a03107d",
        "streamUrl": "http://online-radiorelax2.tavrmedia.ua/RadioRelax_Instrumental",
        "bgcolor": "white",
        "blockStyle": "white",
        "siteUrl": "http://www.radiorelax.com.ua"
    }];

    // Initialization

    var mode = RelaxHub.Player.setMode();
    $(document.body).addClass(mode + '-mode');

    var players = [];
    channels.forEach(function(el) {
        var player = new RelaxHub.Player($.extend({}, options.player, el));
        player.insert($('#wrapper'));
        players.push(player);
    });

    // Controll helpers

    var stopOthers = function (playerId) {
        players.forEach(function(player) {
            if (player.getId() != playerId) {
                player.send('stop');
            }
        });
    };

    // View helpers

    var renderPlayerStatus = function (playerId, text) {
        var b = $('#' + playerId).parent().find('.display');
        b.text(text);
    };

    var playSymbol = "\u25ba",
        playSymbolTitle = "\u25b8",
        pauseSymbol = "\u2759\u2759";
    var addTitlePrefix = function (prefix) {
        document.title = prefix + " " + document.title;
    };
    var clearTitlePrefix = function () {
        if (playSymbolTitle + " " == document.title.substring(0, playSymbolTitle.length + 1)) {
            document.title = document.title.substring(playSymbolTitle.length + 1);
        } else if (pauseSymbol + " " == document.title.substring(0, pauseSymbol.length + 1)) {
            document.title = document.title.substring(pauseSymbol.length + 1);
        }
    };
    var setTitlePrefix = function (prefix) {
        clearTitlePrefix();
        if (prefix != "") {
            addTitlePrefix(prefix);
        }
    };

    var setStatus = function (playerId, status) {
        switch (status)
        {
            case "":
                renderPlayerStatus(playerId, "");
                setTitlePrefix("");
                break;

            case "play":
                renderPlayerStatus(playerId, playSymbol);
                setTitlePrefix(playSymbolTitle);
                break;

            case "pause":
                renderPlayerStatus(playerId, pauseSymbol);
                setTitlePrefix(pauseSymbol);
                break;
        }
    };

    // Players events handling

    playerStatusChanged = function (playerId, status) {
        switch (status) {
            case "play":
                stopOthers(playerId);
                setStatus(playerId, "play");
                break;

            case "stop":
            case "end":
            case "error":
            case "player_error":
                setStatus(playerId, "");
                break;

            case "pause":
                setStatus(playerId, "pause");
                break;
        }
    };
})();
